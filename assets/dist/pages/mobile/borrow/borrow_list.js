define(function(require){var e=require("jquery"),a=require("asPieProgress"),r=require("layer.m/1.6/layer.m"),o=e("#borrow_type"),t=e("#borrow_num"),l=e("#page_size"),n=e("#order_column"),i=e("#order_value"),s=e("#user_id"),c="";r.closeAll();r.open({type:2,shadeClose:false,content:"加载中..."});e(function(){if(o.val()==""||o.val()=="0"){c="全部项目"}else if(o.val()=="1"){c="新手标"}else if(o.val()=="246"){c="新车贷"}else if(o.val()=="245"){c="祺天车贷"}else if(o.val()=="247"){c="祺天房贷"}else if(o.val()=="565"){c="票据贷"}else{c="全 部"}var a='<a href="/phone/user/" class="a-left-link hide">注册</a>'+'<h1 class="primary-title" id="j-project-nav">'+c+'<i id="j-project-nav-i" class="qtydfont ml5">&#xe61f;</i></h1>'+'<nav class="project-nav">'+'<a data="0" href="/phone/borrow/borrow_list?borrow_type=0"'+(o.val()=="0"||o.val()==""?'class="current"':"")+">全部项目</a>"+'<a data="1" href="/phone/borrow/borrow_list?borrow_type=1"'+(o.val()=="1"?'class="current"':"")+">新手标</a>"+'<a data="246" href="/phone/borrow/borrow_list?borrow_type=246"'+(o.val()=="246"?'class="current"':"")+">新车贷</a>"+'<a data="245" href="/phone/borrow/borrow_list?borrow_type=245"'+(o.val()=="245"?'class="current"':"")+">祺天车贷</a>"+'<a data="247" href="/phone/borrow/borrow_list?borrow_type=247"'+(o.val()=="247"?'class="current"':"")+">祺天房贷</a>"+'<a data="247" href="/phone/borrow/borrow_list?borrow_type=565"'+(o.val()=="565"?'class="current"':"")+">票据贷</a>"+'</nav><span class="icon-primary-nav qtydfont" id="icon-primary-nav">&#xe603;</span>'+'<nav class="primary-nav-group">';a+='<a href="/phone/welcome"><i class="qtydfont">&#xe604;</i>首页</a>';if(s.val()<=0){a+='<a href="/phone/user/login.html"><i class="qtydfont">&#xe60d;</i>登录</a>'+'<a href="/phone/user/reg/"><i class="qtydfont">&#xe667;</i>注册</a>'+'<a id="nav_calc" href="javascript:void(0);"><i class="qtydfont">&#xe663;</i>收益计算器</a>'}else{a+='<a href="/phone/account/recharge"><i class="qtydfont">&#xe613;</i>充值</a>'+'<a href="/phone/account/cash_apply"><i class="qtydfont">&#xe60f;</i>提现</a>'+'<a href="/phone/borrow/borrow_list"><i class="qtydfont">&#xe60e;</i>投资</a>'+'<a id="nav_calc" href="javascript:void(0);"><i class="qtydfont">&#xe663;</i>收益计算器</a>'+'<a href="/phone/user/logout.html"><i class="qtydfont">&#xe618;</i>安全退出</a>'}e("#header").html(a);e("#icon-primary-nav").click(function(){if(e(".primary-nav-group").css("display")=="none"){e(".primary-nav-group").slideDown()}else{e(".primary-nav-group").slideUp()}});e(document).bind("click",function(a){var r=e(a.target);if(r.attr("id")!="icon-primary-nav"){e(".primary-nav-group").slideUp()}});e("a[name='prepare']").each(function(){e(this).click(function(){r.closeAll();v("项目还未开始，敬请期待",2);return false})});e("#nav_calc").click(function(){var a=e(document).width(),o=e(document).height();r.closeAll();r.open({title:"收益计算器",content:'<iframe scrolling="no" width="100%" height="'+(o*.5>500?500:o*.5)+'" allowtransparency="true" class="layui-layer-load" frameborder="0" src="/phone/welcome/calc?apr=&day="></iframe>',shadeClose:false,shade:true,type:1,style:"width:100%"})});var p=e("#j-project-nav"),f=e(".project-nav");p.click(function(){if(!f.is(":visible")){f.slideDown();p.children().html("&#xe62e;")}else{f.slideUp();p.children().html("&#xe61f;")}});e(document).bind("click",function(a){var r=e(a.target);if(r.attr("id")!="j-project-nav"&&r.attr("id")!="j-project-nav-i"){f.slideUp();p.children().html("&#xe61f;")}});var h=2,u=t.val(),m=u/l.val();m=Math.ceil(m);e(window).scroll(function(){var a=0;if(document.compatMode==="CSS1Compat"){a=document.documentElement.scrollHeight-(document.documentElement.scrollTop+document.body.scrollTop)-document.documentElement.clientHeight}else{a=document.body.scrollHeight-document.body.scrollTop-document.body.clientHeight}if(a<=100){if(h>m){return false}r.closeAll();r.open({content:"数据加载中",type:2,shadeClose:false});e.ajax({url:"/phone/borrow/borrow_list/"+h+"?format=json&borrow_type="+o.val()+"&order_column="+n.val()+"&order_value="+i.val(),type:"GET",data:{},dataType:"json",cache:false,async:false,success:function(a){r.closeAll();var o=a.borrow_list;var t="";if(typeof o!="undefined"){var l=o.length;for(var n=0;n<l;n++){var i=o[n].borrow_info,s="",c="";if(i.operate=="已满标"){s="finish"}else if(i.operate=="已还款"){s="repayment"}else if(i.new_hand==1){s="novice"}else if(i.apr>=16){s="welfare"}var p="";if(i.invest_balance>0){p="可投金额:  ¥ "+i.invest_balance}else{p="项目金额:  ¥ "+i.loan_amount}c='<a left_time="0" borrow_id="'+i.id+'" invest_percent="'+i.invent_percent+'" operate="'+i.operate+'" class="project-item '+s+'">'+"<dl>"+'<dd class="c-primary"><span class="ft25">'+i.apr+"</span> %</dd>"+"<dt>年利率</dt>"+"</dl>"+"<dl>"+'<dd><span class="ft18">'+i.loan_period.num+"</span>"+i.loan_period.unit+"</dd>"+"<dt>期限</dt>"+"</dl>"+'<div class="p-item-progress">'+'<div class="pie_progress" role="progressbar" data-goal="100" data-barcolor="#f0494f"'+'data-fillcolor="#fff" data-barsize="6" aria-valuemax="100">'+'<div class="project-time"></div>'+"</div>"+"</div>"+'<h3 class="ft14">'+i.borrow_name+'<span class="c-999 ft12">'+p+"</span></h3>"+"</a>";t+=c}h++;e(".project-list").append(t);e(".project-list a").each(function(){d(e(this))})}},error:function(){r.closeAll()}})}});e(".project-list a").each(function(){d(e(this))});r.closeAll()});function d(e){var a=e.attr("operate");var r=e.attr("left_time");var o=e.attr("invest_percent");var t=e.attr("borrow_id");var l=e.find(".project-time").eq(0);var n=e.find(".pie_progress").eq(0);if(r>0){p(n,0);f(r,l,t)}else{if(a=="已满标"||a=="已还款"){n.attr("data-barcolor","#999");l.addClass("c-999")}p(n,o);l.html(a);e.attr("href","/phone/borrow/index/"+t)}}function p(e,a){e.asPieProgress({namespace:"pieProgress"}).asPieProgress("go",a)}function f(e,a,r){var o=e;var t=setInterval(function(){if(o>0){o-=1;var e=Math.floor(o/3600%24);var l=Math.floor(o/60%60);var n=Math.floor(o%60);a.html((e<10?"0"+e:e)+":"+(l<10?"0"+l:l)+":"+(n<10?"0"+n:n))}else{clearInterval(t);a.html("立即投资");var i=a.parent().parent().parent();i.unbind("click");i.attr("href","/phone/borrow/index/"+r).unbind("click")}},1e3)}function v(e,a){r.closeAll();r.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:a})}});