define(function(require){var e=require("jquery"),n=require("layer.m/1.6/layer.m"),a=require("../common");var t=require("weixinshare");var s=encodeURIComponent(d()+"/phone/zt/birthday_coupon");var i="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb064da906d7e2418&redirect_uri="+s+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect";n.closeAll();n.open({type:2,shadeClose:false,content:"加载中..."});var c=true;e(function(){if(e("#answer_btn").html()!=="undefined"){e("#answer_btn").bind("click",function(){var n=e("#answer").val();e("#answer").val("");e("#answer").focus();if(e.trim(n)===""){if(c){o("亲，答案不能为空哦！");c=false;e("#answer").blur()}return false}r(n)})}e("html,body").animate({scrollTop:e("html")[0].scrollHeight},500)});t.ready(function(){t.hideAllNonBaseMenuItem();t.showMenuItems({menuList:["menuItem:share:appMessage","menuItem:share:timeline"]});t.onMenuShareAppMessage({title:"我的第一次，仅献给您！",desc:"领张年化券，理财收益更多咯。",link:i,imgUrl:d()+"/assets/dist/topic/coupon/images/wxshare.jpg",trigger:function(e){},success:function(e){alert("分享成功")},cancel:function(e){alert("您取消了分享")},fail:function(e){}});t.onMenuShareTimeline({title:"我的第一次，仅献给您！",desc:"领张年化券，理财收益更多咯。",link:i,imgUrl:d()+"/assets/dist/topic/coupon/images/wxshare.jpg",trigger:function(e){},success:function(e){alert("分享成功")},cancel:function(e){alert("您取消了分享")},fail:function(e){}});n.closeAll()});function r(n){e.ajax({url:"/phone/zt/birthday_answer",type:"get",data:{answer:n},async:false,dataType:"JSON",success:function(a){if(a.code==1e4){e("#answer").blur();l(n);o(a.answer);if(a.coupon_state==1){e(".fixed-send").html('<a href="'+a.url+'" class="btn-send btn-send-all">去使用</a>')}else{if(a.count==8){e(".fixed-send").html('<a href="'+a.url+'" class="btn-send btn-send-all">去看看</a>')}}}else{e("#answer").blur()}},error:function(){alert("系统出错，请稍后再试。")}})}function l(n){var a="";a+='<li class="chatuser">';a+='<img src="'+e("#user_img").val()+'">';a+='<div class="chatsay">';a+='<div class="chatsay-info">'+n+"</div>";a+="</div>";a+="</li>";e(".chatview").append(a);c=true;e("html,body").animate({scrollTop:e("html")[0].scrollHeight},500)}function o(n){var a="";a+='<li class="chatme">';a+='<img src="/assets/src/topic/coupon/images/default_avatar.png">';a+='<div class="chatsay">';a+='<div class="chatsay-info">'+n+"</div>";a+="</div>";a+="</li>";e(".chatview").append(a);e("html,body").animate({scrollTop:e("html")[0].scrollHeight},500)}function u(){return window.document.location.href}function d(){return localhostPaht=u().substring(0,u().indexOf(f()))}function f(){return window.document.location.pathname}});