define(function(require){var e=require("jquery");require("../common");require("regex");var n=require("jquery.swiper.min");e(function(){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:true,direction:"vertical"})});var a=require("layer.m/1.6/layer.m"),s,t="",c=e("#phone"),l="",i="",o=e("#btnSendSms"),r=e("#voice_sms"),f=e("#sms"),d=e("#valid_code"),u=e("#btn_li"),p,h=e("#login_pwd"),y="";e(function(){c.blur(function(){var n=e(this).val();if(e.trim(n)==""){l=e(this).attr("nullmsg")}else if(!qtyd_regex.phone(n)){l=e(this).attr("errormsg")}else{l=""}if(l!=""){m(l,1);return false}e.ajax({url:"/utils/check_mobile",data:{type:"phone",param:n},type:"POST",dataType:"JSON",cache:false,async:false,success:function(e){if(e.code!=1e4){i="5002"}else{i="5001"}if(l!=""){m(l,1);return false}}})}).keydown(function(e){var n=e.charCode?e.charCode:e.keyCode;return n>=48&&n<=57||n>=96&&n<=105||n==8||n==46||n==39||n==37||n==110});e("#index_btn_submit").click(function(){a.closeAll();a.open({type:2,shadeClose:false,content:"系统处理中..."});var n=false;e.ajax({url:"/phone/zt/get_time",type:"POST",dataType:"JSON",cache:false,async:false,success:function(e){if(e.code!=1e4){n=true;a.closeAll();a.open({content:e.msg,shadeClose:false,btn:["去祺天优贷"],style:"min-width:300px;",yes:function(){window.location.href="/";return false}})}return false}});if(!n){c.trigger("blur");if(l!=""){return false}window.location.href="/phone/zt/send_sms?trackid="+e("#trackid").val()+"&invite_code="+e("#invite_code").val()+"&phone="+c.val()+"&sms_type="+i;return false}});f.click(function(){v(0)});r.click(function(){v(1)});d.blur(function(){var n=e(this).val();if(e.trim(n)==""){t="请输入验证码"}else if(!qtyd_regex.number(n)){t="验证码格式错误"}else{t=""}if(t==""){e.ajax({url:"/async/check_valicode",data:{valicode:n,phone:e("#phone_num").val(),sms_type:e("#sms_type").val()},type:"POST",dataType:"json",cache:false,async:false,success:function(e){if(e.code!=1e4){t="验证码错误"}else{t=""}}})}if(t!=""){m(t,1);return false}});e("#btn_submit").click(function(){d.trigger("blur");if(t==""){a.closeAll();a.open({type:2,shadeClose:false,content:"系统处理中..."});e.ajax({url:"/phone/zt/get_reward",data:{phone:e("#phone_num").val(),sms_type:e("#sms_type").val(),valicode:d.val(),trackid:e("#trackid").val(),invite_code:e("#invite_code").val()},type:"POST",dataType:"text",cache:false,async:false,success:function(n){var a=e.parseJSON(n);if(a.code==1e4){window.location.href=a.url}else if(a.code==53006){m(a.msg,2);window.location.href="/activity/qifu1018.html"}else{m(a.msg,2)}return false},error:function(){m("领取红包失败，请重试",2);return false}})}else{return false}});h.blur(function(){var n=e(this).val();if(e.trim(n)==""){y=e(this).attr("nullmsg")}else if(!(n.length>=6&&n.length<=24)){y=e(this).attr("errormsg")}else{y=""}if(y!=""){m(y,1);return false}});e("#set_pwd").click(function(){h.trigger("blur");if(y!=""){return false}a.closeAll();a.open({type:2,shadeClose:false,content:"系统处理中..."});e.ajax({url:"/phone/zt/change_psw",data:{password:h.val()},type:"POST",dataType:"JSON",cache:false,async:false,success:function(e){if(e.code==1e4){window.location.href="/phone/mine/sina_open?url=/phone/account/reward_tickets"}else{m(e.msg,2)}return false},error:function(){m("密码设置失败，请重试",2);return false}})});e("#btn-share").click(function(){var e=a.open({type:1,content:'<div class="dialog-share"><i class="closediy"></i><i class="icon-guide"></i>成功邀请好友领取，<br>再得一个8.88元红包奖励。<br>赶紧分享吧！</div>',style:"background-color: transparent; box-shadow: none;",success:function(n){var s="getElementsByClassName";n[s]("closediy")[0].onclick=function(){a.close(e)}}})});e("#btn-share-succeed").click(function(){var e=a.open({type:1,content:'<div class="dialog-succeed"><i class="closediy"></i><p>好友通过您分享的活动页面进行注册，</p><p>好友获得<span>60</span>元新手大礼包，</p><p>您获得<span>5</span>元红包奖励；</p><p>好友投资≥1000元，</p><p>您再获得<span>50</span>元红包奖励。</p><a href="" class="btn-use">立即使用</a></div>',style:"background-color: transparent; box-shadow: none;",success:function(n){var s="getElementsByClassName";n[s]("closediy")[0].onclick=function(){a.close(e)}}})});f.trigger("click")});function v(n){a.closeAll();a.open({type:2,shadeClose:false,content:"系统处理中..."});if(s){window.clearInterval(s)}if(n==1){r.off("click")}e.ajax({type:"POST",cache:false,url:"/async/send_sms",dataType:"JSON",data:{phone:e("#phone_num").val(),sms_type:e("#sms_type").val(),op_type:n,trackid:e("#trackid").val(),ip:e("#ip").val()},success:function(n){a.closeAll();if(n.code==1e4){e(".btn-wrap").hide();u.show();p=n.data.time;if(s)clearInterval(s);s=setInterval(function(){o.attr("disabled",true).text(p+"秒后重新发送").addClass("disabled");p-=1;if(p<0){clearInterval(s);e(".btn-wrap").show();u.hide();r.on("click",function(){v(1)})}},1e3);t=""}else{t=n.msg;m(t,1);r.on("click",function(){v(1)})}},error:function(){t="网络异常，发送短信验证码失败，请重试";m(t,1);r.on("click",function(){v(1)})}})}function m(e,n){a.closeAll();a.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:n})}});