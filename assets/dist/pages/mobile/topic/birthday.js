define(function(require){var e=require("jquery"),s=require("jquery.qrcode.min"),l=require("layer.m/1.6/layer.m"),t=e("#reward_success"),a=e("#card_type"),i=e("#reward_dialog"),n=e("#reward_dialog_close"),o=e("#reward_tips"),r=e("#reward_username"),c=e("#reward_nick_name"),d=e("#btnSubmit"),f=e("#user_message"),p=e("#look-gold"),v=e("#render_code"),m=e("#render_code_content"),u=e("#words_length"),h=e("#device_port"),y,g=e("#user_id"),b=e("#address_default");if(e.trim(a.val())==""){l.closeAll();y=l.open({type:2,shadeClose:false,content:"加载中..."})}e(function(){if(e.trim(a.val())!=""){if(t.val()==1){if(c.val()!=""){o.html("恭喜您帮<span>#"+c.val()+"#</span>打开红包，周年庆更多好礼等您来拆。")}else{o.html("恭喜您帮<span>#"+r.val()+"#</span>打开红包，周年庆更多好礼等您来拆。")}}else if(t.val()==2){o.text("您的好友已经获取到红包了哦！")}else if(t.val()==3){o.text("好可惜，活动结束了呢！");e("#a_birthday").hide()}else if(t.val()==-1){o.text("抱歉，红包拆开失败！")}else{o.html("")}if(o.html()!=""){var s=l.open({type:1,shadeClose:false,content:i.html(),style:"box-shadow: none; border-radius: 0;",success:function(e){var t="getElementsByClassName";e[t]("btn-primary")[0].onclick=function(){l.close(s)}}})}}else{if(parseInt(g.val())>0&&parseInt(b.val())<=0){l.open({content:'<div class="tac"><p class="c-999 mt5">奖品会自动发货至默认地址，快去设置哦~</p></div>',btn:["去设置"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/mine/address?device_port="+h.val();return false}})}}if(m.val()!=undefined&&m.val()!=""){var n="";if("undefined"==typeof document.body.style.maxHeight){n="table"}else{n="canvas"}var x="/favicon.ico";if(m.val().toString().indexOf("anniversary")>-1){x="/assets/dist/images/moblie/reward.png"}v.qrcode({render:n,width:148,height:148,correctLevel:0,text:m.val(),src:x})}e("#get-explain").click(function(){var e=l.open({type:1,shadeClose:false,content:'<div class="explain-dialog"><img src="/assets/dist/topic/birthday/images/get_explain.png"><ol><li>1月19日11点公布中奖名单；</li><li>公布名单后，小祺将在7个工作日内安排纪念币发放；</li><li>纪念币将按照默认收货地址发放，如需修改，请联系客服并提供订单号。</li></ol><a class="btn-primary btn-closediy">知道了</a></div>',style:"box-shadow: none; border-radius: 0;",success:function(s){var t="getElementsByClassName";s[t]("btn-closediy")[0].onclick=function(){l.close(e)}}})});e("#reward-split").click(function(){var e=l.open({type:1,shadeClose:false,content:'<div class="explain-dialog"><img src="/assets/dist/topic/birthday/images/get_explain.png"><ol><li>活动结束后，小祺将在7个工作日内安排纪念币发放；</li><li>纪念币将按照默认收货地址发放，如需修改，请联系客服并提供订单号。</li></ol><a class="btn-primary btn-closediy">知道了</a></div>',style:"box-shadow: none; border-radius: 0;",success:function(s){var t="getElementsByClassName";s[t]("btn-closediy")[0].onclick=function(){l.close(e)}}})});e("#reward-explain").click(function(){var e=l.open({type:1,shadeClose:false,content:'<div class="explain-dialog"><img src="/assets/dist/topic/birthday/images/reward_explain.png"><ol><li>红包使用时间：1月19日-1月22日；</li><li>红包领取说明：祺友成功投资获得二维码后，需邀请好友扫描，即可拆开红包，每个用户仅限一次。</li></ol><a class="btn-primary btn-closediy">知道了</a></div>',style:"box-shadow: none; border-radius: 0;",success:function(s){var t="getElementsByClassName";s[t]("btn-closediy")[0].onclick=function(){l.close(e)}}})});e(".qtyd-recommend-info").click(function(){window.location.href="/phone/zt/birthday_20160118_message_list?device_port="+h.val();return false});e("a.btn-more").click(function(){if(p.hasClass("ellipsis")){p.removeClass("ellipsis");e(this).html("收起&gt;&gt;")}else{p.addClass("ellipsis");e(this).html("查看全文&gt;&gt;")}});f.bind("input propertychange",function(){var s=200-e(this).val().length;if(s<0){u.text("0");e(this).val(e(this).val().substr(0,200));return false}else{u.text(s)}}).blur(function(){if(e.trim(e(this).val())==""){_("请输入话题，有机会赢得1枚金币哦",2);return false}});d.click(function(){if(e.trim(f.val())==""){_("请输入话题，有机会赢得1枚金币哦",2);return false}e(this).attr("disabled","disabled").text("发布中");e.ajax({url:"/phone/zt/birthday_20160118_messageDo",type:"POST",dataType:"JSON",data:{message:f.val(),device_port:h.val()},cache:false,success:function(e){if(e.code==1e4){l.closeAll();l.open({content:'<div class="tac"><i class="qtydfont c-success ft25">&#xe61b;</i><p class="c-999 mt5">话题发布成功</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.reload(true);return false}})}else if(e.code==51004){_("请您先登录",2);window.location.href="/phone/user/login.html?refer=/activity/anniversary.html"}else{_(e.msg,3);d.removeAttr("disabled").text("发布")}return false}})});if(e.trim(a.val())==""){if(parseInt(g.val())>0&&parseInt(b.val())<=0){}else{l.closeAll(y)}}});function _(e,s){l.closeAll();l.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:s})}});