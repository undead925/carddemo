define(function(require){var e=require("jquery"),a=require("layer.m/1.6/layer.m");e(function(){var r=0;var s=0;var t=0;var n=0;var l=0;var o=true;var c=e("#game_no").val();var d=true;var u=e("#device_port").val();var p=false;var f="";v(e("#sys_time").val(),e("#between_time").val());function v(r,s){var t=r;var n=setInterval(function(){if(t>0){t-=1;if(t<=10){if(typeof e(".btn-login").attr("href")=="undefined"){e(".game-countdown").show();e(".game-countdown span").html(t);p=true}}var r=Math.floor(t/3600%24);var i=Math.floor(t/60%60);var l=Math.floor(t%60);var v="距"+c+"活动开始：";v+="<span>"+(r<10?"0"+r:r)+"</span>时";v+="<span>"+(i<10?"0"+i:i)+"</span>分";v+="<span>"+(l<10?"0"+l:l)+"</span>秒";e(".count-down").html(v)}else{if(p){e(".game-countdown").hide()}if(o){e(".count-down").html(c+"红包雨活动进行中");h()}t-=1;if(t<=s){if(c=="第三场"){if(d){if(u!="ios"&&u!="android"){f="/"}else{f="app:home"}a.open({type:1,content:'<div class="layer-result over"><h2 class="layer-result-title">活动已结束，<br>更多精彩正在继续！</h2><div class="layer-result-pic"><img src="/assets/src/topic/reward_rain/images/over_bg.png" class="w-100"></div><a href="'+f+'" class="btn-result">去看看</a></div>',style:"width: 90%; background-color: transparent;",shadeClose:false});clearInterval(n)}}else{if(d){window.location.reload();return false}}}}},1e3)}function h(){if(typeof e(".btn-login").attr("href")=="undefined"){e.ajax({url:"/phone/zt/check_rain_status",type:"GET",cache:false,data:{},dataType:"JSON",async:false,success:function(a){if(a.status==0){if(a.code==11e3){e(".count-down").html("您本场获得 红包"+a.reward_sum+"个，红包券"+a.reward_coupon_sum+"个")}else{e(".count-down").html(c+"红包雨活动进行中")}}else if(a.status==1){d=false;if(p){g()}else{p=false;var r=3;e(".game-countdown").show();e(".game-countdown span").html(r);var s=setInterval(function(){r--;e(".game-countdown span").html(r);if(r<=0){e(".game-countdown").hide();clearInterval(s);g()}},1e3)}}o=false},error:function(){}})}}function g(){e(".game").removeClass("hide");var i=(new Date).getTime();var o=1;var d=new Array("reward_11.png","reward_21.png","reward_31.png","reward_41.png","reward_51.png");var p=new Array("reward_12.png","reward_22.png","reward_32.png","reward_42.png","reward_52.png");var v=setInterval(function(){var h=(new Date).getTime();var g=h-i;e(".countdown").html(30-parseInt(g/1e3)+"s");var y=parseInt(Math.random()*100%5);if(g>=3e4){if(t>0){if(u!="ios"&&u!="android"){f="/phone/account/reward_tickets"}else{f="app:userReward"}a.open({type:1,content:'<div class="layer-result"><h2 class="layer-result-title">恭喜您本场获得了</h2><div class="layer-result-pic"><img src="/assets/src/topic/reward_rain/images/hongbao_bg.png" class="hongbao"><ul><li>红包: '+n+"个</li><li>红包券: "+l+'张</li></ul></div><a href="'+f+'" class="btn-result">查看战果</a></div>',style:"width: 90%; background-color: transparent;",shadeClose:false})}else{if(c=="第一场"){a.open({type:1,content:'<div class="layer-result"><h2 class="layer-result-title">手太慢，没有抓住有奖红包！</h2><div class="layer-result-tips">下场活动<span class="c-red">15:00</span>开始，记得来哦！</div><div class="layer-result-pic"><img src="/assets/src/topic/reward_rain/images/miss_bg.png" class="w-100"></div><a href="###" class="btn-result">回到会场</a></div>',style:"width: 90%; background-color: transparent;",shadeClose:false});e(".btn-result").bind("click",function(){window.location.reload()})}else if(c=="第二场"){a.open({type:1,content:'<div class="layer-result"><h2 class="layer-result-title">真是可惜呀，换个姿势再抓！</h2><div class="layer-result-tips">下场活动<span class="c-red">20:00</span>开始，记得来哦！</div><div class="layer-result-pic"><img src="/assets/src/topic/reward_rain/images/miss_bg.png" class="w-100"></div><a href="###" class="btn-result">回到会场</a></div>',style:"width: 90%; background-color: transparent;",shadeClose:false});e(".btn-result").bind("click",function(){window.location.reload()})}else if(c=="第三场"){if(u!="ios"&&u!="android"){f="/"}else{f="app:home"}a.open({type:1,content:'<div class="layer-result over"><h2 class="layer-result-title">活动已结束，<br>更多精彩正在继续！</h2><div class="layer-result-pic"><img src="/assets/src/topic/reward_rain/images/over_bg.png" class="w-100"></div><a href="'+f+'" class="btn-result">去看看</a></div>',style:"width: 90%; background-color: transparent;",shadeClose:false})}}w();clearInterval(v)}else{var _=parseInt(Math.random()*100);var b="";if(_>=50){b="<div id='"+o+"' class='reward-gift' style='opacity:1;bottom:"+(100-_)+"%;"}else{b="<div id='"+o+"' class='reward-gift' style='opacity:1;top:"+_+"%;"}var k=parseInt(Math.random()*100);if(k>=50){b+="right:"+(100-k)+"%;background: url(/assets/src/topic/reward_rain/images/"+d[y]+") no-repeat center top;background-size: 100%;' data='"+p[y]+"'></div>"}else{b+="left:"+k+"%;background: url(/assets/src/topic/reward_rain/images/"+d[y]+") no-repeat center top;background-size: 100%;' data='"+p[y]+"'></div>"}e(".game").append(b);e("#"+o).bind("touchstart",function(){r++;if(t<3){if(parseInt(Math.random()*100)>=90){m()}else{s++;if(s>=10){m()}}}var a=e(this).attr("id");e(this).unbind("touchstart");e(this).stop();e(this).css("background-image","url(/assets/src/topic/reward_rain/images/"+e(this).attr("data")+")");e(this).css("opacity",1);setTimeout(function(){e("#"+a).remove()},1500)});e("#"+o).animate({opacity:"0"},{duration:3e3,queue:false,complete:function(){e(this).remove()}});o++}},1e3)}function m(){e.ajax({url:"/phone/zt/give_rain_reward",type:"GET",cache:false,data:{},dataType:"JSON",async:false,success:function(a){if(a.status==0){}else if(a.status==1){t++;e(".reward-number span").html(t+"个");s=0;if(a.type=="reward"){n++}else if(a.type=="reward_coupons"){l++}}},error:function(){}})}function w(){var a=0;if(c=="第一场"){a=1}else if(c=="第二场"){a=2}else if(c=="第三场"){a=3}e.ajax({url:"/phone/zt/rain_info_cache",type:"GET",cache:false,data:{index:a,click_sum:r,reward_sum:n,reward_coupon_sum:l},dataType:"JSON",async:false,success:function(e){},error:function(){}})}function y(e,r){a.closeAll();a.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:r})}(function(e){e.fn.textSlider=function(a){a=jQuery.extend({speed:"normal",line:2,timer:3e3},a);return this.each(function(){e.fn.textSlider.scllor(e(this),a)})};e.fn.textSlider.scllor=function(a,r){var s=e("ul:eq(0)",a);var t;var n=s.children();var l=e(n[0]).height();var o=0-r.line*l;var c=function(){s.animate({marginTop:o},r.speed,function(){for(i=0;i<r.line;i++){s.find("li:first",a).appendTo(s)}s.css({marginTop:0})})};var d=function(){t=window.setInterval(c,r.timer)};var u=function(){window.clearInterval(t)};s.hover(u,d).mouseout()}})(jQuery);e(document).ready(function(){e(".world-heroes-roll").textSlider({line:1,speed:500,timer:3e3})});e(".a-rule").click(function(){var e=a.open({type:1,content:'<div class="layer-result rule"><i class="closediy" style=""></i><h2>★ 活动规则 ★</h2><ol><li>活动时间：2016年2月18日11:00、15:00、20:00；</li><li>活动期间，用户点击活动页面中“红包君”，即有机会获得祺福红包；</li><li>参与资格：新老用户均可参加，不限场次；</li><li>活动所领取的红包（券），有效期截止2月19日23:59:59。<span class="c-red">红包攻略：</span><ol><li>遇到红包君，立马抓即可！</li><li>牢记下一场抓红包时间预告。</li><li>每个活动整点后15分钟为抓红包的有效时间。</li></ol></li></ol><p>如有疑问请拨打客服热线：<span class="c-red">400-720-1188</span>。<br>本次活动最终解释权归祺天优贷所有。</p></div>',style:"width: 90%; background-color: transparent;",success:function(r){var s="getElementsByClassName";r[s]("closediy")[0].onclick=function(){a.close(e)}}})})})});