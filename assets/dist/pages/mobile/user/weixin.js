define(function(require){var e=require("jquery");require("../common");require("regex");var n=require("layer.m/1.6/layer.m"),t=e("#unbind_submit_weixin"),i=e("#login_submit_weixin"),r=e("#reg_submit_weixin"),a=e("#user_name"),s=e("#password"),l=e("#valid_code"),o=e("#btnSendSms"),c=e("#invite_user"),f=e("#phone"),d="",u="",p="",h="",m="";n.closeAll();n.open({type:2,shadeClose:false,content:"加载中..."});e(function(){e("#header a").eq(0).text("");e(".icon-primary-nav").hide();if(a!=undefined){a.blur(function(){var n=e(this).val();var t="";if(e.trim(n)==""){t="请输入手机号码"}else if(!qtyd_regex.phone(n)){t="手机号码格式不正确"}if(t==""){e.ajax({url:"/utils/check_mobile",data:{type:"phone",param:n},type:"POST",dataType:"json",cache:false,async:false,success:function(e){if(e.code==1e4){t="手机号码还未注册"}}})}if(t!=""){m=t;y(t);return false}else{m=""}})}if(s!=undefined){s.blur(function(){var n=e(this).val();var t="";if(e.trim(n)==""){t=e(this).attr("nullmsg")}else if(!(n.length>=6&&n.length<=24)){t=e(this).attr("errormsg")}if(t!=""){u=t;y(t);return false}else{u=""}})}if(c!=undefined){c.blur(function(){var n=e(this).val();if(e.trim(n)!=""){e.ajax({url:"/utils/check_mobile",data:{type:"phone",param:n},type:"POST",dataType:"json",cache:false,async:false,success:function(e){if(e.code==1e4){h="邀请人号码还未注册";y(h);return false}else{h=""}}})}})}if(l!=undefined){l.blur(function(){var n=e(this).val();var t="";if(e.trim(n)==""){t="请输入短信验证码"}else if(!qtyd_regex.number(n)){t="短信验证码格式错误"}if(t==""){e.ajax({url:"/async/check_valicode",data:{valicode:n,phone:f.val(),sms_type:"registered"},type:"POST",dataType:"json",cache:false,async:false,success:function(e){if(e.code!=1e4){t="短信验证码错误"}else{t=""}}})}if(t!=""){p=t;y(t);return false}else{p=""}}).keydown(function(e){var n=e.charCode?e.charCode:e.keyCode;return n>=48&&n<=57||n>=96&&n<=105||n==8||n==46||n==39||n==37||n==110})}if(o!=undefined){var v,g;o.click(function(){f.trigger("blur");if(d!="")return false;e.ajax({type:"POST",cache:false,async:false,url:"/async/send_sms",dataType:"json",data:{phone:f.val(),sms_type:"registered"},success:function(e){if(e.code==1e4){v=e.data.time;if(g)clearInterval(g);g=setInterval(function(){o.attr("disabled",true).text(v+"秒后重新发送").addClass("disabled");v-=1;if(v<0){clearInterval(g);o.attr("disabled",false).text("短信验证码").removeClass("disabled")}},1e3)}else{y("发送验证码失败");return false}},error:function(){y("网络异常，发送短信验证码失败，请重试");return false}})})}if(t!=undefined){t.click(function(){n.open({type:2,shadeClose:false,content:"正在提交申请..."});e.ajax({url:"/phone/weixin/unbindDo",type:"POST",data:{weixinid:e("#weixinid").val()},cache:false,dataType:"json",success:function(e){if(e.weixin_retCode==60014){y("解除绑定成功");WeixinJSBridge.call("closeWindow");return false}else{y("解除绑定失败");WeixinJSBridge.call("closeWindow");return false}},error:function(){y("登录异常")}})})}if(i!=undefined){i.click(function(){e("#user_name").trigger("blur");if(m!=""){return}e("#password").trigger("blur");if(u!="")return;n.open({type:2,shadeClose:false,content:"登录中..."});e("#login-form").submit()})}if(r!=undefined){r.click(function(){e("#phone").trigger("blur");if(d!=""){return false}e("#password").trigger("blur");if(u!="")return false;e("#valid_code").trigger("blur");if(p!=""){return false}e("#invite_user").trigger("blur");if(h!=""){return false}n.open({type:2,shadeClose:false,content:"数据提交中..."});e("#reg-form").submit()})}n.closeAll()});function y(e){n.closeAll();n.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:1})}e("#j-user-protocol").click(function(){var t=n.open({type:1,content:'<div class="protocol-head">祺天优贷注册协议</div><div class="protocol-cont" style="height:'+document.documentElement.clientHeight+'px; box-sizing: border-box;"><div id="user-protocol" style="overflow: auto; height:100%; "></div></div><div class="protocol-foot"><button class="btn-primary closediy">同意</button></div>',style:"width:100%; overflow:auto; height:"+document.documentElement.clientHeight+"px;",success:function(e){var i="getElementsByClassName";e[i]("closediy")[0].onclick=function(){n.close(t)}}});e("#user-protocol").load("/phone/user/reg_protocol.html")})});