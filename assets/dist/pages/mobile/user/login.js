define(function(require){var e=require("jquery");require("../common");require("regex");var r=require("layer.m/1.6/layer.m"),n=e("#login_phone"),o=e("#login_password"),t=e("#login_submit"),a="",l="",s=e("#refer"),i=e("#error_msg"),c=e("#track_id");r.closeAll();r.open({type:2,shadeClose:false,content:"加载中..."});e(function(){e("#header h1").text("登录");if(i.val()!=""){f(i.val(),3)}n.focusout(function(){var r=e(this).val();if(e.trim(r)==""){a="请输入手机号码"}else if(!qtyd_regex.phone(r)){a="手机号码格式不正确"}else{a=""}if(a==""){e.ajax({url:"/utils/check_mobile",data:{type:"phone",param:r},type:"POST",dataType:"json",cache:false,async:false,success:function(e){if(e.code==1e4){a="手机号码还未注册"}else{a=""}},error:function(){a="手机号码还未注册"}})}if(a!=""){f(a,1);return false}}).focusin(function(){e(this).val("")}).keydown(function(e){var r=e.charCode?e.charCode:e.keyCode;return r>=48&&r<=57||r>=96&&r<=105||r==8||r==46||r==39||r==37||r==110});o.focusout(function(){var r=e(this).val();if(e.trim(r)==""){l=e(this).attr("nullmsg")}else if(!(r.length>=6&&r.length<=24)){l=e(this).attr("errormsg")}else{l=""}if(l!=""){f(l,1);return false}}).focusin(function(){e(this).val("")});t.click(function(){n.trigger("blur");if(a!=""){return}o.trigger("blur");if(l!="")return;r.open({type:2,shadeClose:false,content:"登录中..."});e.ajax({url:"/phone/user/login",type:"POST",data:{user_name:n.val(),password:o.val(),refer:s.val(),is_remember:e("#cb_remember").prop("checked")?"1":"0",track_id:c.val()},cache:false,dataType:"json",success:function(e){if(e.code==1e5){if(e.refer!=""){window.location.href=e.refer}else{window.location.href="/phone/account/"}return false}else{f(e.msg,3);return false}},error:function(){f("登录异常",1);return false}})});r.closeAll()});function f(e,n){r.closeAll();r.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:n})}});