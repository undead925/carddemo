define(function(require,exports,module){var e=require("jquery");var a=require("layer.m/1.6/layer.m");require("../common");require("regex");var t=require("../common"),s=e("#money"),l=e("#pay_password"),n=e("#available_money"),o=e("#bank_id"),i=e("#cash_apply_submit"),c=e("#is_exists_bank"),r=e("#pay_pwd"),d=e("#single_limit");a.closeAll();a.open({type:2,shadeClose:false,content:"加载中..."});var f="",p="";e(function(){e("#header h1").text("提现");e("#header a").eq(0).attr("href","/phone/account/").html('<i class="qtydfont">&#xe623;</i>返回');if(parseInt(r.val())==0){a.closeAll();a.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">您还没设置支付密码，立即去设置</p></div>',shadeClose:false,btn:["好"],style:"min-width:300px;",yes:function(){window.location.href="/phone/mine/pay_pwd";return false}});return false}if(parseInt(c.val())==0){a.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">您还没有可用银行卡，请您添加</p></div>',shadeClose:false,btn:["好"],style:"min-width:300px;",yes:function(){window.location.href="/phone/account/bank_add";return false}});return false}var t=e("section[name='safety_bank']");if(t.length>0){var h=t.eq(0);if(h.hasClass("selected")){h.addClass("selected");o.val(h.attr("id"))}}var v=e("section[name='quick_bank']");if(v.length>0){for(var y=0;y<v.length;y++){var b=false;var m=v.eq(y).attr("id");var _=e("#bank_tips_"+m);if(_.val()==""){v.eq(y).addClass("selected");o.val(v.eq(y).attr("id"));break}}}s.blur(function(){var a=e(this).val(),t=parseFloat(n.val().replace(",",""));if(!qtyd_regex.money(a)){f="金额必须为数字，小数点后不超过2位"}else if(parseFloat(a)>t){f="超过最大可提现金额"}else if(parseFloat(a)<=0){f="请输入有效金额"}else if(parseFloat(a)>parseFloat(d.val())){f="单笔最大提现金额为"+d.val()+"元"}else{f=""}if(f!=""){u(f,2);return false}else{f=""}}).keydown(function(e){var a=e.charCode?e.charCode:e.keyCode;return a>=48&&a<=57||a>=96&&a<=105||a==8||a==46||a==39||a==37||a==190||a==110});l.blur(function(){var a=e(this).val();if(e.trim(a)==""){p="必须输入支付密码";u(p,1);return false}p=""});i.click(function(){if(o.val()==""){u("请选择提现银行卡",1);return false}s.trigger("blur");if(f!="")return false;l.trigger("blur");if(p!=""){return false}a.open({type:2,shadeClose:false,content:"提现中..."});e.ajax({url:"/phone/account/cash_apply",type:"POST",data:{amount:s.val(),bank_id:o.val(),pay_pwd:l.val()},cache:false,dataType:"json",success:function(e){if(e.code==1e5){a.closeAll();a.open({content:'<div class="tac"><i class="qtydfont c-success ft25">&#xe61b;</i><p class="c-999 mt5">申请提现成功，等待银行处理</p></div>',btn:["查看提现记录"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/account/trade_log?account_type=cash_apply";return false}})}else if(e.code>=110023&&e.code<=110026){a.closeAll();a.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">登陆超时，请重新登录</p>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/user/login.html";return false}})}else if(e.code==930019){window.location.href="/phone/error/sina_error";return false}else{u("提现申请失败，原因："+e.msg,3);return false}},error:function(){u("提现申请失败，请稍后再试",1);return false}})});e("section[name='quick_bank']").each(function(){e(this).click(function(){module.exports.change_bank(e(this).attr("id"))})});e("section[name='safety_bank']").each(function(){e(this).click(function(){module.exports.change_bank(e(this).attr("id"))})});e("#j-protocol").click(function(){var t=a.open({type:1,content:'<div class="protocol-head">新浪支付快捷支付使用协议</div><div class="protocol-cont" style="height:'+document.documentElement.clientHeight+'px; box-sizing: border-box;"><div id="user-protocol" style="overflow: auto; height:100%; "></div></div><div class="protocol-foot"><button class="btn-primary closediy">同意</button></div>',style:"width:100%; overflow:auto; height:"+document.documentElement.clientHeight+"px;",success:function(e){var s="getElementsByClassName";e[s]("closediy")[0].onclick=function(){a.close(t)}}});e("#user-protocol").load("/welcome/sina_pay_quick_service_protocol_box")});a.closeAll()});module.exports={change_bank:function(a){var t=e("#"+a);t.addClass("selected");t.siblings().removeClass("selected");var n=e("#bank_tips_"+a);var o=e("#tips");if(n.val()==""){e("#bank_id").val(a);o.addClass("hide").html("");s.attr("disabled",false);l.attr("disabled",false);i.attr("disabled",false).removeClass("disabled")}else{o.removeClass("hide").html(n.val());e("#bank_id").val("");s.attr("disabled",true);l.attr("disabled",true);i.attr("disabled",true).addClass("disabled")}}};function u(e,t){a.closeAll();a.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:t})}});