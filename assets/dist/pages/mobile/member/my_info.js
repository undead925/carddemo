define(function(require,exports,module){var e=require("jquery"),a=require("regex"),n=require("layer.m/1.6/layer.m"),i=require("../common"),l=require("webuploader/webuploader");n.closeAll();n.open({type:2,shadeClose:false,content:"加载中..."});var r={nick_name:$("#nick_name"),income:$("#income"),education:$("#education"),professional:$("#professional"),marry:$("#marry"),child:$("#child"),linkman:$("#linkman"),phone:$("#phone"),yanglao:$("#yanglao"),renshou:$("#renshou"),id_address:$("#id_address"),address:$("#address"),header:$("#header"),is_error:false,img_url:$("#img_url"),file_size:3072*102400,thumbnailWidth:30,thumbnailHeight:30,init:function(){var e=this;e.linkman.blur(function(){if($.trim($(this).val())!=""){$.ajax({url:"/phone/mine/check_link_man",data:{link_man:e.linkman.val()},type:"POST",dataType:"JSON",cache:false,success:function(a){if(a.code==1e4){e.is_error=false}else{e.is_error=true;e.show_error(a.msg,1)}}})}});e.phone.blur(function(){if($.trim($(this).val())!=""){if(!qtyd_regex.phone($(this).val())){e.is_error=true;e.show_error("紧急联系人手机号码格式错误",1);return false}else{$.ajax({url:"/phone/mine/check_link_phone",type:"POST",data:{link_phone:e.phone.val()},dataType:"JSON",cache:false,success:function(a){if(a.code==1e4){e.is_error=false}else{e.is_error=true;e.show_error(a.msg,1);return false}}})}}});e.header.html('<a href="javascript:history.back();" class="a-back"><i class="qtydfont">&#xe623;</i>返回</a><h1 class="primary-title">我的资料</h1><a class="a-right-link" id="btnSave" href="javascript:;">保存</a>');$("#btnSave").click(function(){e.linkman.trigger("blur");if(e.is_error){return false}e.phone.trigger("blur");if(e.is_error){return false}e.on_save()});$(".webuploader-pick").css("background-color","#FFFFFF")},show_error:function(e,a){n.closeAll();n.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:a})},on_save:function(){n.closeAll();n.open({type:2,shadeClose:false,content:"保存中..."});var e=this;$.ajax({url:"/phone/mine/my_info_do",type:"POST",dataType:"JSON",cache:false,data:{nick_name:e.nick_name.val(),img_url:e.img_url.val(),marriage:e.marry.val(),child:e.child.val(),yanglao:e.yanglao.val(),renshou:e.renshou.val(),education:e.education.val(),id_address:e.id_address.val(),address:e.address.val(),income:e.income.val(),professional:e.professional.val(),linkman:e.linkman.val(),link_phone:e.phone.val()},success:function(a){n.closeAll();if(a.code==1e5){n.open({content:'<div class="tac"><i class="qtydfont c-success ft25">&#xe61b;</i><p class="c-999 mt5">保存成功</p></div>',shadeClose:false,style:"min-width:300px;",btn:["好"],yes:function(){window.location.href="/phone/account/";return false}})}else{e.show_layer(a.msg,2)}},error:function(){e.show_layer("数据保存异常",2)}})}};var s={auto:true,swf:"/assets/dist/lib/webuploader/Uploader.swf",server:$("#base_url").val()+"/phone/mine/my_info_image_upload",pick:{id:$("#litpic"),multiple:false},chunkRetry:3,threads:1,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},sendAsBinary:false,fileSizeLimit:r.file_size};var o=WebUploader.create(s);o.on("uploadAccept",function(e,a){if(a.code==1e4){$("#litpic").find("img").eq(0).attr("src",$("#pic_url").val()+a.image);$("#img_url").val(a.image)}else{r.show_error(a.msg,2)}});o.on("uploadProgress",function(e,a){n.closeAll();n.open({type:2,shadeClose:false,content:"当前上传"+a*100+"%"})});o.on("beforeFileQueued",function(e){if(s.fileSizeLimit<e.size){r.show_error("头像文件超过限制（3M以内）",2);return false}});o.on("uploadComplete",function(e){n.closeAll()});$(function(){r.init();n.closeAll()})});