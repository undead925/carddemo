define(function(require){var e=require("jquery"),o=require("layer.m/1.6/layer.m");require("regex");require("../common");o.closeAll();o.open({type:2,shadeClose:false,content:"加载中..."});var t=e("#real_name"),n=e("#card_id"),s=e("#sina_cash_move_submit"),l="",a="";e(function(){e("#header h1").text("资金迁移");e("#header a").eq(0).attr("href","/phone/account/").html('<i class="qtydfont">&#xe623;</i>返回');t.blur(function(){var o=e(this).val();if(e.trim(o)==""){l=e(this).attr("nullmsg")}else{l=""}if(l!=""){c(l,1);return false}});n.blur(function(){var o=e(this).val();var t=qtyd_regex.card_id_reg(o);if(e.trim(o)==""){a=e(this).attr("nullmsg")}else if(t==false){a=e(this).attr("errormsg")}else{a=""}if(a==""){e.ajax({type:"post",url:"/phone/mine/check_saving_pot_allow",cache:false,data:{card_id:o},dataType:"json",async:false,success:function(e){if(e.code==1){a=""}else{a="该身份证号不允许开通新浪支付存钱罐（可能已经开通）"}},error:function(){a="该身份证号不允许开通新浪支付存钱罐（可能已经开通）"}})}if(a!=""){c(a,2);return false}}).keydown(function(e){var o=e.charCode?e.charCode:e.keyCode;return o>=48&&o<=57||o>=96&&o<=105||o==8||o==46||o==39||o==37||o==88||o==120||o==110});s.click(function(){t.trigger("blur");if(l!="")return false;n.trigger("blur");if(a!="")return false;o.open({type:2,shadeClose:false,content:"资金迁移中..."});e.ajax({url:"/phone/mine/sina_cash_move",data:{real_name:t.val(),card_id:n.val()},type:"post",cache:false,dataType:"json",success:function(e){if(e.code==1e5){o.closeAll();o.open({content:'<div class="tac"><i class="qtydfont c-success ft25">&#xe61b;</i><p class="c-999 mt5">恭喜，资金迁移成功</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/mine/novice_packs";return false}})}else if(e.code>=110023&&e.code<=110026){o.closeAll();o.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">登陆超时，请重新登录</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/user/login.html";return false}})}else if(e.code==930019){window.location.href="/phone/error/sina_error";return false}else{c("资金迁移失败，失败原因："+e.msg,3);return false}},error:function(){c("资金迁移失败",1);return false}})});o.closeAll()});e("#j-user-protocol").click(function(){var t=o.open({type:1,content:'<div class="protocol-head">存钱罐服务协议</div><div class="protocol-cont" style="height:'+document.documentElement.clientHeight+'px; box-sizing: border-box;"><div id="user-protocol" style="overflow: auto; height:100%; "></div></div><div class="protocol-foot"><button class="btn-primary closediy">同意</button></div>',style:"width:100%; overflow:auto; height:"+document.documentElement.clientHeight+"px;",success:function(e){var n="getElementsByClassName";e[n]("closediy")[0].onclick=function(){o.close(t)}}});e("#user-protocol").load("/welcome/saving_pot_service_protocol_box")});function c(e,t){o.closeAll();o.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:t})}});