define(function(require){var e=require("jquery");var l=require("layer.m/1.6/layer.m");require("regex");require("../common");l.closeAll();l.open({type:2,shadeClose:false,content:"加载中..."});var n=e("#email"),t=e("#email_submit"),a="",s=e("#email_status"),i=e("#header");e(function(){if(s.val()!=""){if(s.val()=="0"){i.find("h1").eq(0).text("激活邮箱")}else{i.find("h1").eq(0).text("修改邮箱")}}else{i.find("h1").eq(0).text("设置邮箱")}i.find("a").eq(0).attr("href","/phone/mine/safety").html('<i class="qtydfont">&#xe623;</i>返回');n.blur(function(){if(!qtyd_regex.email(e.trim(e(this).val()))){a="邮箱地址格式错误";o(a,1);return false}else{a=""}}).keydown(function(e){var l=e.charCode?e.charCode:e.keyCode;if(l==13){t.trigger("click")}});t.click(function(){n.trigger("blur");if(a!=""){return false}l.closeAll();l.open({type:2,shadeClose:false,content:"数据提交中..."});e.ajax({url:"/phone/mine/email",type:"POST",data:{email:n.val()},dataType:"JSON",cache:false,success:function(e){if(e.code==1e5){l.closeAll();l.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">验证邮件已经发送到您的邮箱，请您到邮箱进行验证</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/mine/safety";return false}})}else{o("邮件发送失败，失败原因："+e.msg,3);return false}},error:function(){o("邮件发送失败",1);return false}})});l.closeAll()});function o(e,n){l.closeAll();l.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:n})}});