define(function(require,exports,module){var e=require("jquery"),n=require("layer.m/1.6/layer.m");require("../common");var t=e("#img_valid_code"),a=e("#exchange_code"),c=e("#btnSubmit"),l=e("#valid_code"),o="",s="";n.closeAll();n.open({type:2,shadeClose:false,content:"加载中..."});e(function(){e("#header h1").text("红包券兑换");e("#header a").eq(0).attr("href","/phone/account/reward_tickets").html('<i class="qtydfont">&#xe623;</i>返回');t.click(function(){e(this).attr("src","/admin/verify?_r="+Math.random())});l.blur(function(){var n=e(this).val();if(e.trim(n)==""){o="请输入验证码"}else{o=""}if(o==""){e.ajax({url:"/utils/check_img_valid_code",data:{valid_code:n},type:"POST",dataType:"json",cache:false,async:false,success:function(e){if(e.code!=1e4){o="验证码错误"}else{o=""}},error:function(){o="验证码错误"}})}if(o!=""){r(o,1);return false}});a.blur(function(){var n=e(this).val();if(e.trim(n)==""){s="请输入兑换码"}else{s=""}if(s!=""){r(s,1);return false}});c.click(function(){a.trigger("blur");if(s!=""){return false}l.trigger("blur");if(o!=""){return false}n.closeAll();n.open({type:2,shadeClose:false,content:"兑换中..."});e.ajax({url:"/phone/account/reward_exchange",type:"POST",data:{exchange_code:a.val()},dataType:"json",cache:false,success:function(e){if(e.code==1e5){n.closeAll();n.open({content:'<div class="tac"><i class="qtydfont c-success ft25">&#xe61b;</i><p class="c-999 mt5">兑换成功</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/account/reward_tickets";return false}})}else if(e.code>=110023&&e.code<=110026){n.closeAll();n.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">登陆超时，请重新登录</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/user/login.html";return false}})}else if(e.code==930019){window.location.href="/phone/error/sina_error";return false}else{r("兑换失败，失败原因："+e.msg,3);return false}},error:function(){r("兑换失败",1);return false}})});n.closeAll()});function r(e,t){n.closeAll();n.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:t})}});