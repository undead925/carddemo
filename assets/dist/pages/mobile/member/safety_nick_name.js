define(function(require,exports,module){var e=require("jquery"),n=require("layer.m/1.6/layer.m");require("regex");require("../common");n.closeAll();n.open({type:2,shadeClose:false,content:"加载中..."});var s=e("#nick_name"),a="",l=e("#nick_name_submit");e(function(){e("#header h1").text("设置昵称");e("#header a").eq(0).attr("href","/phone/mine/safety").html('<i class="qtydfont">&#xe623;</i>返回');s.blur(function(){var n=e(this).val();if(e.trim(n)==""){a="请输入昵称"}else{a=""}if(a==""){e.ajax({url:"/phone/mine/check_user_nickname",type:"POST",data:{nick_name:n},dataType:"json",cache:false,async:false,success:function(e){if(e.code==1e5){a=""}else{a=e.msg}}});if(a!=""){o(a,3);return false}}else{o(a,1);return false}}).keydown(function(e){var n=e.charCode?e.charCode:e.keyCode;if(n==13){l.trigger("click")}});l.click(function(){s.trigger("blur");if(a!=""){return false}n.closeAll();n.open({type:2,shadeClose:false,content:"数据提交中..."});e.ajax({url:"/phone/mine/nick_name",type:"POST",data:{nick_name:s.val()},cache:false,dataType:"json",success:function(e){if(e.code==1e5){n.closeAll();n.open({content:'<div class="tac"><i class="qtydfont c-success ft25">&#xe61b;</i><p class="c-999 mt5">修改昵称成功</p>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/mine/safety";return false}})}else if(e.code>=110023&&e.code<=110026){n.closeAll();n.open({content:'<div class="tac"><i class="qtydfont c-warning ft25">&#xe630;</i><p class="c-999 mt5">登陆超时，请重新登录</p></div>',btn:["好"],style:"min-width:300px;",shadeClose:false,yes:function(){window.location.href="/phone/user/login.html";return false}})}else if(e.code==930019){window.location.href="/phone/error/sina_error";return false}else{o(e.msg,3);return false}},error:function(){o("修改昵称失败",1);return false}})});n.closeAll()});function o(e,s){n.closeAll();n.open({content:e,type:1,style:"padding:10px 15px; background-color:rgba(0,0,0,0.5); color:#fff; border:none;",shadeClose:false,shade:false,time:s})}});